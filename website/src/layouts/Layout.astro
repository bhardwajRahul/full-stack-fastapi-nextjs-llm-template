---
import CursorGlow from '../components/CursorGlow.astro';

interface Alternate {
  lang: string;
  href: string;
}

interface Props {
  title: string;
  description?: string;
  lang?: string;
  alternates?: Alternate[];
}

const {
  title,
  description = "Generate production-ready AI/LLM applications with FastAPI + Next.js. 5 AI frameworks, 75+ config options, 3 presets.",
  lang = "en",
  alternates = [],
} = Astro.props;

const rawBase = import.meta.env.BASE_URL;
const base = rawBase.endsWith("/") ? rawBase : rawBase + "/";
const siteUrl = Astro.site?.origin ?? "https://example.com";
const canonicalURL = new URL(Astro.url.pathname, siteUrl).href;
const ogImageURL = new URL(`${base}og-image.png`, siteUrl).href;

const keywords = "fastapi, nextjs, ai, llm, pydantic ai, langchain, langgraph, crewai, project generator, template, full-stack, python, react, docker, kubernetes";

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  name: "Fullstack AI Agent Template",
  description,
  url: siteUrl,
  applicationCategory: "DeveloperApplication",
  operatingSystem: "Cross-platform",
  offers: { "@type": "Offer", price: "0", priceCurrency: "USD" },
  programmingLanguage: ["Python", "TypeScript"],
  author: { "@type": "Organization", name: "vstorm" },
};
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content="vstorm" />
    <meta name="generator" content={Astro.generator} />

    <link rel="canonical" href={canonicalURL} />

    {alternates.map((alt) => (
      <link rel="alternate" hreflang={alt.lang} href={new URL(alt.href, siteUrl).href} />
    ))}
    {alternates.length > 0 && (
      <link rel="alternate" hreflang="x-default" href={new URL("/", siteUrl).href} />
    )}

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={ogImageURL} />
    <meta property="og:site_name" content="Fullstack AI Agent Template" />
    <meta property="og:locale" content={lang} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageURL} />

    <link rel="icon" type="image/x-icon" href={`${base}favicon.ico`} />
    <link rel="icon" type="image/png" sizes="192x192" href={`${base}favicon.png`} />
    <link rel="apple-touch-icon" href={`${base}apple-touch-icon.png`} />
    <link rel="manifest" href={`${base}site.webmanifest`} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

    <title>{title}</title>
  </head>
  <body class="min-h-screen bg-bg text-text antialiased">
    <!-- Grid background -->
    <div class="grid-bg pointer-events-none fixed inset-0 z-0" aria-hidden="true"></div>

    <CursorGlow />
    <div class="relative z-10">
      <slot />
    </div>
    <!-- Scroll reveal observer -->
    <script is:inline>
      (function() {
        var io = new IntersectionObserver(function(entries) {
          entries.forEach(function(e) {
            if (e.isIntersecting) {
              e.target.classList.add('visible');
              io.unobserve(e.target);
            }
          });
        }, { threshold: 0.12 });
        document.querySelectorAll('.reveal').forEach(function(el) { io.observe(el); });
      })();
    </script>
  </body>
</html>

<style is:global>
  @import "../styles/global.css";
</style>
