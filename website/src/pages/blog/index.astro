---
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/landing/Footer.astro';
import BlogCard from '../../components/blog/BlogCard.astro';
import { getCollection } from 'astro:content';
import { translations, languages, defaultLang } from '../../i18n/translations';

const lang = defaultLang;
const t = translations[lang];

const posts = (
  await getCollection('blog', ({ data }) => data.lang === 'en' && !data.draft)
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const alternates = [
  { lang: "en", href: "/blog/" },
  ...Object.keys(languages)
    .filter((l) => l !== defaultLang)
    .map((l) => ({ lang: l, href: `/${l}/blog/` })),
];
---

<Layout
  title={`${t["blog.title"]} â€” Fullstack AI Agent Template`}
  description={t["blog.subtitle"]}
  lang={lang}
  alternates={alternates}
>
  <Navbar currentLang={lang} />

  <main class="mx-auto max-w-3xl px-4 py-16 sm:py-24">
    <div class="mb-12 text-center">
      <h1 class="text-3xl font-bold tracking-tight sm:text-4xl">{t["blog.title"]}</h1>
      <p class="mt-4 text-text-secondary">{t["blog.subtitle"]}</p>
    </div>

    {posts.length === 0 ? (
      <p class="text-center text-text-secondary">No posts yet. Check back soon.</p>
    ) : (
      <div class="space-y-4">
        {posts.map((post) => {
          const slug = post.id.split('/').slice(1).join('/');
          return (
            <BlogCard
              title={post.data.title}
              description={post.data.description}
              pubDate={post.data.pubDate}
              href={`/blog/${slug}/`}
              tags={post.data.tags}
              lang={lang}
            />
          );
        })}
      </div>
    )}
  </main>

  <Footer t={t} />
</Layout>
